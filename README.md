# ‚öôÔ∏è –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è —Å—Ç–µ–Ω–¥–æ–≤ –≤ Proxmox VE

## üìÑ –û–ø–∏—Å–∞–Ω–∏–µ

–î–∞–Ω–Ω—ã–π Bash-—Å–∫—Ä–∏–ø—Ç –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å —Å—Ç–µ–Ω–¥—ã –≤ –≥–∏–ø–µ—Ä–≤–∏–∑–æ—Ä–µ **Proxmox VE**, –≤–∫–ª—é—á–∞—é—â–∏–µ:

- –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ç–µ–≤—ã—Ö –º–æ—Å—Ç–æ–≤
- –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—à–∏–Ω –∏–∑ —à–∞–±–ª–æ–Ω–æ–≤
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Å–µ—Ç–µ–≤—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
- –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –ø—É–ª–æ–≤
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å–Ω–æ–µ –º–µ–Ω—é

---

## üì¶ –°–æ—Å—Ç–∞–≤ —Å—Ç–µ–Ω–¥–∞

–ö–∞–∂–¥—ã–π —Å—Ç–µ–Ω–¥ –≤–∫–ª—é—á–∞–µ—Ç 4 –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã:

| –í–ú   | –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã              |
|------|-------------------------|
| ISP  | vmbr0, vmbrX            |
| RTR  | vmbrX, vmbrX+1, vmbrX+2 |
| SRV  | vmbrX+1                 |
| CLI  | vmbrX+2                 |

–ì–¥–µ `vmbrX` ‚Äî —Å–µ—Ç–µ–≤—ã–µ –º–æ—Å—Ç—ã, —Å–æ–∑–¥–∞–≤–∞–µ–º—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥ –∫–∞–∂–¥—ã–π —Å—Ç–µ–Ω–¥.

---

## ‚öôÔ∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π Proxmox VE
- –®–∞–±–ª–æ–Ω—ã –í–ú —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º–∏ VMID (ISP, RTR, SRV, CLI)
- –ü—Ä–∞–≤–∞ root
- `qm`, `pveum`, `systemctl` –≤ –æ–∫—Ä—É–∂–µ–Ω–∏–∏

---

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

1. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –≤ —Ñ–∞–π–ª, –Ω–∞–ø—Ä–∏–º–µ—Ä: `deploy_stands.sh`
2. –°–¥–µ–ª–∞–π—Ç–µ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º:

```bash
chmod +x deploy_stands.sh
```

3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ:

```bash
./deploy_stands.sh
```

---

## üß≠ –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é

```
+=====================================================+
| 1. –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–æ–≤—ã–µ —Å—Ç–µ–Ω–¥—ã                          |
| 2. –£–¥–∞–ª–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç–µ–Ω–¥—ã                      |
| 3. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–µ—Ç–µ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏                  |
| 4. –í—ã—Ö–æ–¥                                            |
+=====================================================+
```

---

## üìå –û–ø—Ü–∏–∏

### 1. –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–æ–≤—ã–µ —Å—Ç–µ–Ω–¥—ã

–°–∫—Ä–∏–ø—Ç –∑–∞–ø—Ä–æ—Å–∏—Ç:

- VMID —à–∞–±–ª–æ–Ω–æ–≤ –¥–ª—è ISP, RTR, SRV, CLI
- –ö–æ–ª-–≤–æ —Å—Ç–µ–Ω–¥–æ–≤
- –°—Ç–∞—Ä—Ç–æ–≤—ã–π VMID (–Ω–∞–ø—Ä–∏–º–µ—Ä: 1000)

–ö–∞–∂–¥—ã–π —Å—Ç–µ–Ω–¥ —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å —à–∞–≥–æ–º `+10`, –Ω–∞–ø—Ä–∏–º–µ—Ä:

- –°—Ç–µ–Ω–¥ 1: VMID 1010‚Äì1013, –º–æ—Å—Ç—ã vmbr10‚Äìvmbr12
- –°—Ç–µ–Ω–¥ 2: VMID 1020‚Äì1023, –º–æ—Å—Ç—ã vmbr20‚Äìvmbr22  
–∏ —Ç.–¥.

–¢–∞–∫–∂–µ —Å–æ–∑–¥–∞—é—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –ø—É–ª—ã —Å –ø—Ä–∞–≤–∞–º–∏ `PVEVMUser`.

### 2. –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–µ–Ω–¥–æ–≤

–°–∫—Ä–∏–ø—Ç –º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å:

- –û–¥–∏–Ω —Å—Ç–µ–Ω–¥ (–ø–æ –±–∞–∑–æ–≤–æ–º—É VMID)
- –ù–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç–µ–Ω–¥–æ–≤ (—á–µ—Ä–µ–∑ –ø—Ä–æ–±–µ–ª –∏–ª–∏ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–º, –Ω–∞–ø—Ä–∏–º–µ—Ä: `1010 1020 1030` –∏–ª–∏ `1010-1030`)

–£–¥–∞–ª—è—é—Ç—Å—è:

- –í–ú
- –ú–æ—Å—Ç—ã
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- –ü—É–ª

### 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ç–∏

–ö–æ–º–∞–Ω–¥–∞:

```bash
systemctl restart networking
```

---

## üõ† –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –í–ú (–Ω–∞–ø—Ä–∏–º–µ—Ä, MON)

1. –í —Ñ—É–Ω–∫—Ü–∏—é `deploy_user_stand` –¥–æ–±–∞–≤—å—Ç–µ:

```bash
qm clone "$MON" "$((base_vm+4))" --name "MON-$base_vm" || {
    echo "–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ MON"
    return 1
}
qm set "$((base_vm+4))" --net0 e1000,bridge=vmbr$((base_br+1))
```

2. –†–∞—Å—à–∏—Ä—å—Ç–µ —Å–ø–∏—Å–æ–∫ –í–ú –≤ –ø—É–ª–µ:

```bash
pveum pool modify "pool$base_vm" --vms "$base_vm,$((base_vm+1)),$((base_vm+2)),$((base_vm+3)),$((base_vm+4))"
```

3. –í —Ñ—É–Ω–∫—Ü–∏–∏ `delete_stand` —Ä–∞—Å—à–∏—Ä—å—Ç–µ –¥–∏–∞–ø–∞–∑–æ–Ω `seq "$stand_id" "$((stand_id+4))"`

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–∞—Ä–æ–ª—å `P@ssw0rd` –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
- –†–æ–ª—å `PVEVMUser` –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–µ–π—Å—Ç–≤–∏—è–º–∏ —Å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º–∏ –º–∞—à–∏–Ω–∞–º–∏, –≤–∫–ª—é—á—ë–Ω–Ω—ã–º–∏ –≤ —Ç–æ—Ç –∂–µ –ø—É–ª, —á—Ç–æ –∏ –æ–Ω —Å–∞–º.
- –í–æ–∑–º–æ–∂–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω—ã—Ö –ø–∞—Ä–æ–ª–µ–π ‚Äî —Å–º. –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –Ω–∏–∂–µ.

---

## üí° –ò–¥–µ–∏ –¥–ª—è –¥–æ—Ä–∞–±–æ—Ç–∫–∏

- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω—ã—Ö –ø–∞—Ä–æ–ª–µ–π –∏ —ç–∫—Å–ø–æ—Ä—Ç –≤ CSV
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —à–∞–±–ª–æ–Ω–æ–≤ –ø–µ—Ä–µ–¥ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç–µ–Ω–¥–∞–º–∏

---

## üß∞ –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

–ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –í–ú:
```bash
qm destroy <VMID> --purge 1 --destroy-unreferenced-disks 1
```

–ü—Ä–æ—Å–º–æ—Ç—Ä –º–æ—Å—Ç–æ–≤:
```bash
brctl show
```

–ü–æ–∫–∞–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤:
```bash
cat /etc/network/interfaces
```
